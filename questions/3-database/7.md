# 트랜잭션이 무엇이고, ACID 원칙에 대해 설명해 주세요.

### 데이터베이스 커넥션

애플리케이션과 데이터베이스에 접속해서 종료할 때까지 일련의 과정

동시 접속 사용자가 많아질수록 이 과정은 시스템에 부하를 주게 됨

→ 데이터베이스엔 일정 수준의 커넥션 이상으로 연결되지 않도록 설정되어있음

### 데이터베이스 커넥션 풀

애플리케이션에서 필요할 때 커넥션을 만드는 것이 아니라, 일정한 수의 커넥션을 미리 만들어놓고 필요할 때 그 커넥션들을 애플리케이션에 제공하는 관리 체계
미리 커넥션을 생성해놓으므로 데이터베이스의 부하를 줄일 수 있음

커넥션 풀 과정

1. WAS가 미리 일정 수의 커넥션을 생성해 풀을 구성함
2. 요청에 따라 생성된 커넥션 객체를 전달함
3. 일정 수 이상의 커넥션이 사용되면 새로운 커넥션을 만듦
4. 사용하지 않는 커넥션은 종료하고 최소한의 기본 커넥션을 유지함

커넥션 풀은 JNDI을 통해 자바에서 접근 가능함

### 트랜잭션이란?

데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 단위
한꺼번에 수행되어야 할 일련의 연산

프로그램 규모가 커질수록 트랜잭션은 중요하며, 임의로 개발자가 로직을 세워 관리하는 것은 위험하다

### 특징

- 작업의 완전성 보장

논리적인 작업을 완벽하게 처리하지 못하면 원 상태로 복구함

사용자: 작업을 논리적인 단위로 이해할 수 있음

시스템: 데이터 접근 / 변경하는 프로그램의 단위

- ACID 원칙
    - Atomicity 원자성
        
        트랜잭션이 데이터베이스에 모두 반영되거나, 전혀 반영되지 않아야 함
        
    - Consistency 일관성
        
        트랜잭션의 작업 처리 결과는 항상 일관성 있어야 함
        시스템의 고정 요소는 수행 전과 수행 완료 후의 상태가 같아야 함
        
    - Isolation 독립성
    트랜잭션이 두 개 이상 동시에 실행되고 있을 경우 하나의 트랜잭션이 다른 트랜잭션에 끼어들 수 없다
    - Durability 영속성
        
        트랜잭션이 성공적으로 수행되었을 경우, 결과는 영구적으로 반영되어야 함
        
- commit / rollback 연산

### Commit

커밋 연산은 하나의 트랜잭션이 성공적으로 끝났고, 데이터베이스가 일관성 있는 상태에 있을 때 하나의 트랜잭션이 끝났음을 알려주기 위해 사용하는 연산

### Rollback

하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성을 깨뜨렸을 때, 이 트랜잭션의 일부가 정상적으로 처리되었어도 트랜잭션의 원자성을 구현하기 위해 모든 연산을 취소하는 연산

### 트랜잭션 상태

<img width="674" alt="스크린샷 2023-09-22 오후 7 53 15" src="https://github.com/COW-edu/backend-cs-study/assets/104254012/093eed76-402f-460d-8e29-4be89343a673">

- 활동: 트랜잭션 실행 중
- 부분 완료: 트랜잭션의 커밋 명령이 도착함
- 완료: 트랜잭션이 정상적으로 완료된 상태
- 실패: 트랜잭션이 더 이상 정상적으로 진행될 수 없는 상태
- 취소: 트랜잭션이 취소되고 실행 이전 데이터로 돌아간 상태

### 주의할 점

트랜잭션의 범위를 최소화해야 함 - 필요한 최소의 코드에만 적용

데이터베이스의 커넥션 개수는 제한적이므로 각 단위 프로그램이 커넥션을 소유하는 시간이 길어지게 되면 여유 커넥션의 개수는 줄어들게 됨
결과적으로 각 단위 프로그램에서 커넥션을 가져가기 위해 기다려야 하는 상황이 발생할 수 있음
